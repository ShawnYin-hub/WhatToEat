# 🔍 诊断部署问题

## ⚠️ 问题

代码已经修复（`OVERPASS_API_URL = '/api/overpass'`），但错误显示还在直接调用 `overpass-api.de`。

这说明 Vercel 上运行的代码还是旧版本。

## 🔍 诊断步骤

### 步骤 1：确认代码已提交并推送

1. **检查本地更改**
   ```bash
   git status
   ```
   - 如果显示 "nothing to commit"，说明代码已提交
   - 如果有文件显示为 "modified"，需要提交

2. **检查远程同步**
   - 在 GitHub Desktop 中，查看是否显示 "Push origin"
   - 如果有，点击推送

3. **检查 GitHub**
   - 访问：`https://github.com/您的用户名/what-to-eat-today`
   - 点击 `src/services/osmApi.js`
   - 检查第 8 行，应该是：`const OVERPASS_API_URL = '/api/overpass'`

### 步骤 2：检查 Vercel 部署

1. **访问 Vercel Dashboard**
   - https://vercel.com/dashboard
   - 找到 "what-to-eat-today" 项目

2. **查看最新部署**
   - 查看部署时间
   - 确认部署时间是在代码提交之后

3. **检查部署日志**
   - 点击最新部署记录
   - 查看构建日志
   - 确认构建成功，没有错误

4. **检查 Functions**
   - 在项目页面，点击 "Functions" 标签
   - 应该能看到 `api/overpass` 函数
   - 如果看不到，说明 Functions 没有部署

### 步骤 3：手动触发重新部署

如果部署时间不对或构建失败：

1. **在 Vercel Dashboard**
   - 点击项目
   - 点击 "Deployments" 标签
   - 点击最新部署记录右侧的 "..." 菜单
   - 选择 "Redeploy"

2. **或者重新导入项目**
   - 删除项目（Settings > Delete Project）
   - 重新导入 GitHub 仓库

### 步骤 4：完全清除缓存

1. **清除浏览器缓存**
   - 按 `Ctrl + Shift + Delete`
   - 选择所有时间
   - 勾选 "缓存的图像和文件"
   - 点击 "清除数据"

2. **使用隐私模式测试**
   - 打开新的隐私/无痕窗口
   - 访问网站测试

3. **检查网络请求**
   - 打开开发者工具（F12）
   - Network 标签
   - 刷新页面
   - 查看请求到 `/api/overpass` 的请求
   - 请求 URL 应该是：`https://your-site.vercel.app/api/overpass`
   - **不应该**是：`https://overpass-api.de/api/interpreter`

## 🚨 如果还是不行

如果所有步骤都做了还是不行，可能是：

1. **Vercel Functions 没有正确部署**
   - 检查 `api/overpass.js` 文件是否在项目中
   - 检查 Vercel 是否识别了 `api/` 目录

2. **代码构建有问题**
   - 查看 Vercel 构建日志
   - 检查是否有构建错误

3. **可能需要重新创建项目**
   - 在 Vercel 中删除项目
   - 重新从 GitHub 导入

## 💡 快速验证方法

在浏览器开发者工具的 Network 标签中：

- ✅ **如果修复成功**：
  - 请求 URL：`https://your-site.vercel.app/api/overpass`
  - 状态码：200

- ❌ **如果还没修复**：
  - 请求 URL：`https://overpass-api.de/api/interpreter`
  - 状态码：400

---

**关键：确保代码已提交、已推送、Vercel 已部署，然后完全清除浏览器缓存！**
